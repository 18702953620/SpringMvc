<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<title>主页</title>
		<script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
		<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="js/template-web.js"></script>
		<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">

		<style>
			.form-control {
				margin: 15px;
			}
			
			.input-group {
				width: 50%;
				margin-top: 15px;
			}
			
			.nav-pills {
				width: 15%;
				text-align: center;
				margin-top: 50px;
			}
			
			.tab-content {
				margin-left: 20px;
				margin-top: 35px;
				width: 80%;
			}
			
			.navbar {
				width: 80%;
				margin: auto;
			}
			
		</style>
	</head>

	<body>

		<nav class="navbar navbar-default " role="navigation">
			<div class="container-fluid">
				<div class="navbar-header">
					<a class="navbar-brand" href="#">SpringMvc</a>
				</div>
				<div>
					<ul class="nav navbar-nav">
						<li>
							<a href="#">iOS</a>
						</li>
						<li>
							<a href="#">SVN</a>
						</li>
					</ul>
				</div>
			</div>
		</nav>

		<ul id="myTab" class="nav nav-pills nav-stacked pull-left">
			<li class="active">
				<a href="#home" data-toggle="tab">用户</a>
			</li>
			<li>
				<a href="#ios" data-toggle="tab">设置</a>
			</li>
		</ul>

		<div id="myTabContent" class="tab-content pull-right pull-left">
			<div class="tab-pane fade in active" id="home">
				<div id="content"></div>
			</div>
			<div class="tab-pane fade" id="ios">
				<p>iOS 是一个由苹果公司开发和发布的手机操作系统</p>
			</div>
		</div>

		<!-- 模态框（Modal） -->
		<div class="modal fade" id="addUser" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
						<h4 class="modal-title" id="myUser">
					添加用户
				</h4>
					</div>
					<div class="modal-body">
						<div class="input-group" style="display: none;">
							<span class="input_tip">*id</span>
							<input id="id" class="form-control" placeholder="请输入用户名" />
						</div>
						<div class="input-group">
							<span class="input_tip">*用户名</span>
							<input id="username" class="form-control" placeholder="请输入用户名" />
						</div>
						<div class="input-group">
							<span class="input_tip">*密码</span>
							<input id="password" class="form-control" style="-webkit-text-security:disc" placeholder="请输入密码" />
						</div>
						<div class="input-group">
							<span class="input_tip" style="margin-top: 20px;">*手机号</span>
							<input id="phone" type="tel" class="form-control" placeholder="请输入手机号" />
						</div>
						<div class="input-group">
							<span class="input_tip">邮箱</span>
							<input id="email" type="email" class="form-control" placeholder="请输入邮箱" />
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" onclick="addorEditUser()">
					提交
				</button>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal-dialog -->
		</div>
		<!-- /.modal -->
		<!-- 模态框（Modal） -->
		<div class="modal fade" id="deleteUser" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
						<h4 class="modal-title">
					提示
				</h4>
					</div>
					<div class="modal-body">
						<h4 class="modal-title">
					要删除这个用户？
				</h4>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" onclick="deleteUser()">
					提交
				</button>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal-dialog -->
		</div>
		<!-- /.modal -->

		<script>
			var userId;
			$(function() {
				$('#myTab li:eq(0) a').tab('show');
			});

			var url = "http://localhost:8080/SpringMvc/user/getUser";
			$.get(url, function(data) {
				if(data.code == 1) {
					var html = template('list', data.data);
					document.getElementById('content').innerHTML = html;
				} else {
					alert(data.msg)
				}
			});

			//添加用户
			function addorEditUser() {

				var username = $('#username').val();
				var password = $('#password').val();
				var phone = $('#phone').val();
				var email = $('#email').val();
				if(username.length <= 0) {
					alert("用户名不能为空")
					return;
				}
				if(password.length <= 0) {
					alert("密码不能为空")
					return;
				}
				if(phone.length <= 0) {
					alert("手机号不能为空")
					return;
				}
				var title = $('#myUser').html();
				if(title.indexOf("修改") != -1) {
					var id = $('#id').val();
					var url = "http://localhost:8080/SpringMvc/user/updateUser?username=" +
						username + "&password=" + password + "&phone=" + phone + "&email=" + email + "&id=" + id;
					$.get(url, function(data) {
						if(data.code == 1) {
							$('#addUser').modal('hide');
							//刷新界面
							window.location.reload();
						} else {
							alert(data.msg);
						}
					});

				} else {
					var url = "http://localhost:8080/SpringMvc/user/addUser?username=" +
						username + "&password=" + password + "&phone=" + phone + "&email=" + email;
					$.get(url, function(data) {
						if(data.code == 1) {
							$('#addUser').modal('hide');
							//刷新界面
							window.location.reload();
						} else {
							alert(data.msg);
						}
					});
				}

			}

			//删除用户
			function deleteUser() {

				if(userId.length <= 0) {
					alert("id不能为空")
					return;
				}
				var url = "http://localhost:8080/SpringMvc/user/deleteUser?id=" + userId;
				$.get(url, function(data) {
					if(data.code == 1) {
						//刷新界面
						window.location.reload();
					} else {
						alert(data.msg);
					}
				});

			}
			//编辑弹窗
			function showEditDialog(id) {
				var url = "http://localhost:8080/SpringMvc/user/getUser?id=" + id;
				$.get(url, function(data) {
					if(data.code == 1) {
						$('#id').val(data.data.id);
						$('#username').val(data.data.username);
						$('#password').val(data.data.password);
						$('#phone').val(data.data.phone);
						$('#email').val(data.data.email);

						$('#myUser').html("修改用户");

						$('#addUser').modal('show');
					} else {
						alert(data.msg)
					}
				});

			}
			//添加弹窗
			function showAddDialog() {
				$('#id').val('');
				$('#username').val('');
				$('#password').val('');
				$('#phone').val('');
				$('#email').val('');

				$('#myUser').html("添加用户");

				$('#addUser').modal('show');

			}

			function showDeleteDialog(id) {
				userId = id;
				$('#deleteUser').modal('show');
			}
		</script>
		<script id="list" type="text/html">

			<table class="table table-bordered">
				<caption>

				</caption>
				<thead>
					<tr>
						<th>序号</th>
						<th>用户名</th>
						<th>手机号</th>
						<th>邮箱</th>
						<th>创建时间</th>
						<th>修改时间</th>
						<th><button class="btn btn-primary pull-right" data-toggle="modal" onclick="showAddDialog()">添加用户</button></th>
					</tr>
				</thead>
				<tbody>

					{{each $data}}
					<tr>
						<td>{{$index}}</td>
						<td>{{$value.username}}</td>
						<td>{{$value.phone}}</td>
						<td>{{$value.email}}</td>
						<td>{{$value.createTime}}</td>
						<td>{{$value.editTime}}</td>
						<td>
							<button type="button" class="btn btn-default" onclick="showEditDialog({{$value.id}})">编辑</button>
							<button type="button" class="btn btn-default" onclick="showDeleteDialog({{$value.id}})">删除</button>

						</td>
					</tr>
					{{/each}}

				</tbody>
			</table>

		</script>

	</body>

</html>